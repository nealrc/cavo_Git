var InsertSmallLoadingOptions={width:"15px",height:"15px"},RemoveSmallLoadingOptions={width:"auto",height:"auto"},intesting=0;var b;
$(document).ready(function(){var tid,tname;var d;$(".test").click(function(){$("#ctestid").val(0);tid=parseInt($(this).attr("id"));tname=$(this).text();switch($(this).attr("id")){case 1:b=1;d="Vocabulary Test | PinYin Test";break;case 2:b=2;d="Vocabulary Test | Chinese-English Test";break;case 3:b=3;d="Vocabulary Test | Chinese-Chinese Test";break;default:b=tid;d=tname}$("body").append($("#diabox"));$("div.jqmdTC").empty().append(d);if($("#userinfo").length!=0)$("div.jqmdMSG").empty().append($("#userinfo").show());
else{intesting=1;$("#ctestid").val(b);$("div.jqmdMSG").append($("#testing").show());$("#choices").empty().addClass("loading");$("#testsubject").empty().css(InsertSmallLoadingOptions).addClass("smallloading");$("#questioncount").empty().css(InsertSmallLoadingOptions).addClass("smallloading");$("#qtot").empty().css(InsertSmallLoadingOptions).addClass("smallloading");$("#testerror").empty();$("#testsubmit").show();$.getJSON("generator.php",{mytestid:b},function(e){ParseTestData(e)})}$("#diabox").jqm({trigger:false,
target:false,modal:true,closeClass:false,overlay:95}).jqmShow();$("input.jqmdX").hover(function(){$(this).addClass("jqmdXFocus")},function(){$(this).removeClass("jqmdXFocus")}).focus(function(){this.hideFocus=true;$(this).addClass("jqmdXFocus")}).blur(function(){$(this).removeClass("jqmdXFocus")});$.browser.msie&&$("input").focus(function(){$(this).addClass("iefocus")}).blur(function(){$(this).removeClass("iefocus")})});$("#userinfo").length!=0&&$("#form1").submit(function(){$(this).ajaxSubmit({target:"#r",
beforeSubmit:function(){$("#f").hide();$("#r").empty().css("height","100px").addClass("loading")},success:function(c){$("#r").removeClass("loading").css("height","auto");if(c!="success")$("#f").show();else{$("#r").empty();$("#f").show();$("#userinfo").appendTo("body").hide();intesting=1;$("div.jqmdMSG").append($("#testing").show());$("#choices").empty().addClass("loading");$("#testsubject").empty().css(InsertSmallLoadingOptions).addClass("smallloading");$("#questioncount").empty().css(InsertSmallLoadingOptions).addClass("smallloading");
$("#qtot").empty().css(InsertSmallLoadingOptions).addClass("smallloading");$("#testerror").empty();$("#testsubmit").show();$.getJSON("generator.php",{mytestid:b},function(e){ParseTestData(e)})}}});return false});$("#testform").submit(function(){$(this).ajaxSubmit({url:"generator.php",dataType:"json",beforeSubmit:TestLoading,success:function(c){ParseTestData(c);$("#testsubmit").show()}});return false});$("#diabox .jqmClose").click(function(){ConfirmExit(intesting)});$("#finishtest").find("a").click(function(){if($(this).attr("name")==
"cancel")ConfirmExit(intesting);else{intesting=0;$("body").append($("#finishtest").hide());$("div.jqmdMSG").append($("#score").empty().show());$("#score").addClass("loading");$("#score").load("score.php",function(){$("#score").removeClass("loading")})}})});function CleanTestMessage(){$("#choices").empty();$("#testsubject").empty();$("#questioncount").empty();$("#qtot").empty();$("#testerror").empty()}
function CleanTmpTestMessage(){$("#tmptestsubject").empty();$("#tmpquestioncount").empty();$("#tmpqtot").empty();$("#tmptestdisplay").empty()}function TestLoading(){$("#choices").empty().addClass("loading");$("#testsubject").empty().css(InsertSmallLoadingOptions).addClass("smallloading");$("#questioncount").empty().css(InsertSmallLoadingOptions).addClass("smallloading");$("#qtot").empty().css(InsertSmallLoadingOptions).addClass("smallloading");$("#testerror").empty();$("#testsubmit").hide()}
function ParseTestData(a){CleanTestMessage();if(a==1){$("#testerror").append("error => You must make a selection").slideDown("888");$("#questioncount").removeClass("smallloading").css(RemoveSmallLoadingOptions).append($("#tmpquestioncount").contents().clone());$("#qtot").removeClass("smallloading").css(RemoveSmallLoadingOptions).append($("#tmpqtot").contents().clone());$("#testsubject").removeClass("smallloading").css(RemoveSmallLoadingOptions).append($("#tmptestsubject").contents().clone());var b=
"<ul>",d="",c="",e=0;$("#tmptestdisplay").find("li").each(function(){d=$(this).attr("tid");c=$(this).attr("tname");b+='<li><input id="t_'+e+'" name="studentanswer" type="radio" value="'+d+'" /><label for="t_'+e+'">'+c+"</label></li>";e++});b+="</ul>";$("#choices").removeClass("loading").append(b)}else if(a==2){intesting=0;$("#testing").appendTo("body").hide();$.getScript("report.php",function(f){$(".score").empty().append(f+"%");$("div.jqmdMSG").append($("#finishtest").show())})}else{var i="",h="<ul>";
$.each(a.choice,function(f,g){h+='<li><input id="t_'+f+'" name="studentanswer" type="radio" value="'+g.id+'" /><label for="t_'+f+'">'+g.testtype+"</label></li>";i+='<li tid="'+g.id+'" tname="'+g.testtype+'"></li>'});h+="</ul>";$("#tmptestsubject").empty().append(a.question);$("#tmpquestioncount").empty().append(a.num);$("#tmpqtot").empty().append(a.qtot);$("#tmptestdisplay").empty().append(i);$("#questioncount").removeClass("smallloading").css(RemoveSmallLoadingOptions).append(a.num);$("#qtot").removeClass("smallloading").css(RemoveSmallLoadingOptions).append(a.qtot);
$("#testsubject").removeClass("smallloading").css(RemoveSmallLoadingOptions).append(a.question);$("#choices").removeClass("loading").append(h)}}
function ConfirmExit(a){if(a==1){$("body").append($("#exit"));$("#exit").jqm({overlay:80,modal:true,trigger:false}).jqmShow();$("#exit_yes").click(function(){$("body").append($("#testing").hide());$("body").append($("#finishtest").hide());$("#exit").jqmHide();$("#diabox").jqmHide();$("#choices").empty();$("#testsubject").empty();$("#questioncount").empty();$("#qtot").empty();$("#testerror").empty();$("#tmptestsubject").empty();$("#tmpquestioncount").empty();$("#tmpqtot").empty();$("#tmptestdisplay").empty();
intesting=0;$.get("deleterecord.php");location.reload()});$("#exit_no").click(function(){$("#exit").jqmHide();$("body").append($("#exit").hide())})}else{$("#diabox").jqmHide();$("body").append($("#finishtest").hide()).append($("#exit").hide()).append($("#testing").hide()).append($("#score").hide());$("#userinfo").length!=0&&$("body").append($("#userinfo").hide());location.reload()}};
